# Portree Auto-Execution Rules

This project uses **portree** for multi-branch development. When working on this project, automatically manage services.

## Auto-Start on Session Begin

**When starting work on this project, AUTOMATICALLY run:**

```bash
# 1. Start services for current branch
portree up

# 2. Enable subdomain routing
portree proxy start

# 3. Open in browser
portree open
```

Then inform the user what's running and the access URLs.

## Auto-Start on Branch Switch

**When user switches branches or mentions a feature branch, AUTOMATICALLY:**

```bash
# Create worktree if needed
portree add <branch> 2>/dev/null || true

# Start services
portree up

# Open browser
portree open
```

## Auto-Comparison Mode

**When user wants to compare branches, AUTOMATICALLY:**

```bash
portree up --all
portree proxy start
```

Then report:
- main: http://main.localhost:3000
- feature: http://feature-x.localhost:3000

---

## Reference

### Commands
| Command | Action |
|---------|--------|
| `portree up` | Start current branch services |
| `portree up --all` | Start all branches |
| `portree down` | Stop current |
| `portree proxy start` | Enable subdomain routing |
| `portree open` | Open browser |
| `portree dash` | Interactive dashboard |
| `portree ls` | List status |

### URLs
- Format: `http://<branch-slug>.localhost:<proxy-port>`
- Example: `http://feature-auth.localhost:3000`

### Environment Variables (available in services)
- `PORT` - Assigned port
- `PT_BRANCH` - Branch name
- `PT_BRANCH_SLUG` - URL-safe branch
- `PT_{SERVICE}_PORT` - Other service's port
- `PT_{SERVICE}_URL` - Other service's proxy URL

### Configuration (.portree.toml)
```toml
[services.frontend]
command = "npm run dev"
port_env = "PORT"
port_range = [3100, 3199]

[services.backend]
command = "go run ."
port_range = [8100, 8199]
```

### Troubleshooting
- Service won't start → `portree doctor`, check logs in `~/.portree/logs/`
- Port conflict → `lsof -i :<port>`, then `portree restart`
- Proxy issues → Ensure `portree proxy start` ran
