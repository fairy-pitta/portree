# Portree - Git Worktree Server Manager

You are helping a user work with portree, a tool for managing multiple dev servers across git worktrees with automatic port allocation and subdomain-based reverse proxy routing.

## What is Portree?

Portree enables running the same service on multiple branches simultaneously by:
- Automatically allocating unique ports per branch/service
- Providing subdomain-based routing (e.g., `feature-auth.localhost:3000`)
- Managing process lifecycle across worktrees

## Configuration (.portree.toml)

Place in project root:

```toml
[services.SERVICE_NAME]
command = "COMMAND_TO_START"
port_env = "PORT"           # env var name for port (default: PORT)
port_range = [3100, 3199]   # optional port range
env = { KEY = "value" }     # additional env vars
```

### Examples

**Node.js/React/Vite:**
```toml
[services.frontend]
command = "npm run dev"
port_env = "PORT"
```

**Go:**
```toml
[services.api]
command = "go run ./cmd/server"
port_env = "PORT"
port_range = [8100, 8199]
```

**Multi-service:**
```toml
[services.frontend]
command = "npm run dev"
port_range = [3100, 3199]

[services.backend]
command = "go run ."
port_range = [8100, 8199]
```

## Environment Variables

Portree provides these to each service:
- `PORT` - Assigned port
- `PT_BRANCH` - Branch name
- `PT_BRANCH_SLUG` - URL-safe branch (e.g., `feature-auth`)
- `PT_SERVICE` - Service name
- `PT_{SERVICE}_PORT` - Other service's port
- `PT_{SERVICE}_URL` - Other service's proxy URL

## Commands

```bash
# Setup & Status
portree doctor              # Check configuration
portree ls                  # List all worktrees/services

# Worktree Management
portree add <branch>        # Create worktree
portree add -b <new>        # Create new branch + worktree
portree remove <branch>     # Remove worktree

# Service Control
portree up                  # Start current worktree's services
portree up --all            # Start all worktrees
portree down                # Stop current
portree down --all          # Stop all
portree restart             # Restart current

# Proxy & Access
portree proxy start         # Enable subdomain routing
portree proxy stop          # Disable proxy
portree open [service]      # Open in browser
portree dash                # Interactive dashboard
```

## Dashboard Keybindings

- `j/k` or `↑/↓` - Navigate
- `s` - Start service
- `x` - Stop service
- `r` - Restart
- `o` - Open in browser
- `a` - Start all
- `X` - Stop all
- `l` - View logs
- `p` - Toggle proxy
- `q` - Quit

## Common Workflows

### Feature branch development
```bash
portree add feature/my-feature
portree up --all
portree proxy start
# Access: http://feature-my-feature.localhost:3000
```

### Compare branches
```bash
portree up --all
portree proxy start
# main: http://main.localhost:3000
# feature: http://feature-x.localhost:3000
```

### Cleanup
```bash
portree down --all
portree remove merged-branch
```

## Troubleshooting

- **"not a known worktree"** - Run from a git worktree directory
- **Service stops immediately** - Port conflict, check `lsof -i :<port>`
- **Proxy not working** - Use `.localhost` domain, ensure `portree proxy start`
- **Cross-service connection fails** - Use `$PT_{SERVICE}_PORT` or `$PT_{SERVICE}_URL`

## Installation

```bash
# macOS
brew install fairy-pitta/tap/portree

# Or download from GitHub releases
```
